const products = [
  //Dairy products
  [
    {
      name: "Kotmale Cheese Wedges 120g",
      price: 560,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/kothmale cheese wedges.jpg",
    },
    {
      name: "Kotmale Swiss Type Cheese 200g",
      price: 900,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Kotmale Swiss Type Cheese 200g.jpg",
    },
    {
      name: "Kotmale Processed Cheese Paneer 200g",
      price: 880,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/kothmale panner.jpg",
    },
    {
      name: "Kraft Cheese Pkt 250g",
      price: 2725,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Kraft Cheese Pkt 250g.jpg",
    },
    {
      name: "Ambewela Uht Milk 1L",
      price: 530,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Ambewela Uht Milk 1L.jpg",
    },
    {
      name: "Kotmale Full Cream Plain Milk 1L",
      price: 530,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Kothmale full cream milk.jpg",
    },
    {
      name: "Kotmale Full Cream Vanilla 1L",
      price: 580,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Kotmale Full Cream Vanilla 1L.jpg",
    },
    {
      name: "Kotmale Full Cream Chocolate 1L",
      price: 580,
      quantity: "Per 1 unit",
      image: "../Images/dairy products/Kotmale Full Cream Chocolate 1L.jpg",
    },
  ],
  //Vegetables
  [
    {
      name: "Pre-Packed Garlic",
      price: 980,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Pre-Packed Garlic.jpg",
    },
    {
      name: "Cucumber",
      price: 240,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Cucumber.jpg",
    },
    {
      name: "Red Onions",
      price: 470,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Red Onions.jpg",
    },
    {
      name: "Plantain Flower",
      price: 120,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Plantain Flower.jpg",
    },
    {
      name: "Sweet Potato",
      price: 490,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Sweet Potatoe.jpg",
    },
    {
      name: "Kohila",
      price: 460,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Kohila.jpg",
    },
    {
      name: "Batana",
      price: 440,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Batana.jpg",
    },
    {
      name: "Green Cucumber",
      price: 530,
      quantity: "Per 1 unit",
      image: "../Images/vegetables/Green Cucumber.jpg",
    },
  ],
  //Meat and Seafood
  [
    {
      name: "Chicken Full Breast Skinless",
      price: 1980,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/chicken.jpg",
    },
    {
      name: "Aust. Beef",
      price: 5900,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/Beef.jpg",
    },
    {
      name: "Bone In Curry PorkPork Leg Bone In",
      price: 2500,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/Pork Leg Bone In.jpg",
    },
    {
      name: "Mutton Leg Local",
      price: 5590,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/mutton.jpg",
    },
    {
      name: "Prawns Medium",
      price: 2040,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/prawns.jpg",
    },
    {
      name: "Sea Chicken",
      price: 300,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/Sea Chicken.jpg",
    },
    {
      name: "Tuna Fish",
      price: 2190,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/Tuna Fish.jpg",
    },
    {
      name: "Thalapath Small",
      price: 1990,
      quantity: "Per 1 unit",
      image: "../Images/meat and seafood/Thalapath Small.jpg",
    },
  ],
  //Fruits
  [
    {
      name: "Avocado",
      price: 380,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Avocado.jpg",
    },
    {
      name: "Apple-Red",
      price: 2220,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/apple-red.jpg",
    },
    {
      name: "Apple-Green",
      price: 1860,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/apple-green.jpg",
    },
    {
      name: "Kiwi Fruits",
      price: 3490,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Kiwi Fruits.jpg",
    },
    {
      name: "Pineapple",
      price: 990,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Pineapple.jpg",
    },
    {
      name: "Dragon Fruit (Pitaya)",
      price: 990,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Dragon Fruit ( Pitaya ).jpg",
    },
    {
      name: "Mandarin Imported",
      price: 1830,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Mandarin Imported.jpg",
    },
    {
      name: "Melon - Red Fantasy",
      price: 140,
      quantity: "Per 1 unit",
      image: "../Images/fruitd/Melon - Red Fantasy.jpg",
    },
  ],
  //Bakery
  [
    {
      name: "Motha Baking Powder 100g",
      price: 380,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Baking Powder.jpg",
    },
    {
      name: "Anods Cocoa/Dark Choco Chips 250g",
      price: 800,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Dark Choco Chips.jpg",
    },
    {
      name: "Mauri Gelatine 50g",
      price: 550,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Gelatine.jpg",
    },
    {
      name: "Motha Colouring Pink 28ml",
      price: 210,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Colouring Pink.jpg",
    },
    {
      name: "Motha Custard Powder Strawberry 100g",
      price: 160,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Custard.jpg",
    },
    {
      name: "Motha Essence Vanilla 28ml",
      price: 220,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Vanilla.jpg",
    },
    {
      name: "Nestle Milkmaid 510g",
      price: 990,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Milkmaid.jpg",
    },
    {
      name: "Maurimix Pizza Mix 350g",
      price: 1040,
      quantity: "Per 1 unit",
      image: "../Images/Baking/Maurimix.jpg",
    },
  ],
];

function getImage(options, imageContainer) {
  options.addEventListener("change", () => {
    let selectedOption = options.value;
    products.forEach((productCategory) => {
      productCategory.forEach((item) => {
        if (item.name === selectedOption) {
          imageContainer.innerHTML = `<img src="${item.image}" alt="${item.name}" class="orderContainerImg">`;
        }
      });
    });
  });
}

function getPrice(options, priceContainer, quantityInput) {
  let price;
  options.addEventListener("change", () => {
    let selectedOption = options.value;
    products.forEach((productCategory) => {
      productCategory.forEach((item) => {
        if (item.name === selectedOption) {
          price = item.price;
          priceContainer.innerHTML = `<p>Rs.${item.price}</p>`;
          updatePrice(quantityInput, item.price, priceContainer);
        }
      });
    });
  });
}

function updatePrice(quantityInput, price, priceContainer) {
  quantityInput.addEventListener("input", () => {
    const quantity = quantityInput.value;
    const totalPrice = price * quantity;
    priceContainer.innerHTML = `<p>Rs.${totalPrice}</p>`;
  });
}

const orderContainers = document.querySelectorAll(".orderContainer");
console.log(orderContainers);

const cartTableContainer = document.querySelector(".cart-table-container");
const totalDiv = document.querySelector(".total");
let totalPrice = 0;

orderContainers.forEach((container) => {
  const options = container.querySelector("#options");
  const imageContainer = container.querySelector("#imageContainer");
  const priceContainer = container.querySelector("#priceContainer");
  const quantityInput = container.querySelector(".quantity");
  const addToCartButton = container.querySelector("#add-to-cart-order");

  getImage(options, imageContainer);
  getPrice(options, priceContainer, quantityInput);

  addToCartButton.addEventListener("click", () => {
    //creating new table row for cart
    const cartTableRow = document.createElement("tr");
    cartTableRow.className = "cart-table-row";

    //getting the selected product details
    let selectedOption = options.value;
    let productDetails;
    products.forEach((productCategory) => {
      productCategory.forEach((item) => {
        if (item.name === selectedOption) {
          productDetails = item;
        }
      });
    });

    //creating the table cells

    //name
    const productNameCell = document.createElement("td");
    productNameCell.textContent = productDetails.name;

    //image
    const productImageCell = document.createElement("td");
    const productImage = document.createElement("img");
    productImage.src = productDetails.image;
    productImage.alt = productDetails.name;
    productImageCell.appendChild(productImage);

    //quantity
    const quantityCell = document.createElement("td");
    quantityCell.textContent = quantityInput.value;

    //price
    const priceCell = document.createElement("td");
    const totalPriceForItem = productDetails.price * quantityInput.value;
    priceCell.textContent = `Rs.${totalPriceForItem}`;
    totalPrice += totalPriceForItem;

    //Adding the cells to a new row
    cartTableRow.appendChild(productNameCell);
    cartTableRow.appendChild(productImageCell);
    cartTableRow.appendChild(quantityCell);
    cartTableRow.appendChild(priceCell);

    //Adding the table row to the cart table
    let cartTable = cartTableContainer.querySelector("table");
    if (!cartTable) {
      cartTable = document.createElement("table");
      cartTable.className = "cart-table";
      cartTableContainer.appendChild(cartTable);
      const tableHeaderRow = document.createElement("tr");
      const tableHeaderCells = ["Product", "Image", "Quantity", "Price"];
      tableHeaderCells.forEach((cellText) => {
        const tableHeaderCell = document.createElement("th");
        tableHeaderCell.textContent = cellText;
        tableHeaderRow.appendChild(tableHeaderCell);
      });
      cartTable.appendChild(tableHeaderRow);
    }
    cartTable.appendChild(cartTableRow);

    // Save cart data to local storage
    let cartData = JSON.parse(localStorage.getItem("cartData")) || [];
    cartData.push({
      name: productDetails.name,
      image: productImage.src,
      quantity: quantityInput.value,
      price: totalPriceForItem,
    });
    localStorage.setItem("cartData", JSON.stringify(cartData));

    // Update the total price display
    totalDiv.textContent = `Total: Rs. ${totalPrice}`;
  });
});
//the buttons div
const addCartToFavouritesButton = document.querySelector(".add-to-fav");
const removeFavouritesButton = document.querySelector(".remove-fav");
const addFavouritesButton = document.querySelector(".load-fav");
const clearCartButton = document.querySelector(".clear-cart");

//function to add the cart to favourites
function addtofav() {
  const cartTable = cartTableContainer.querySelector("table");
  if (cartTable) {
    let currentTotalPrice = 0;
    const cartRows = cartTable.querySelectorAll("tr.cart-table-row");

    //Calculate the current total price from the cart table
    cartRows.forEach((row) => {
      const quantity = parseFloat(row.cells[2].textContent);
      const price = parseFloat(
        row.cells[3].textContent.replace("Rs.", "").trim()
      );
      currentTotalPrice += price * quantity;
    });

    //Add existing cart items to favourites
    const newFavs = [];
    cartRows.forEach((row) => {
      const productName = row.cells[0].textContent;
      const productImage = row.cells[1].querySelector("img").src;
      const quantity = parseFloat(row.cells[2].textContent);
      const price = parseFloat(
        row.cells[3].textContent.replace("Rs.", "").trim()
      );
      newFavs.push({
        name: productName,
        image: productImage,
        quantity: quantity,
        price: price,
      });
    });

    //Store current total price and items in favourites
    const existingFavourites =
      JSON.parse(localStorage.getItem("favourites")) || [];
    const updatedFavourites = [...existingFavourites, ...newFavs];

    localStorage.setItem("favourites", JSON.stringify(updatedFavourites));
    localStorage.setItem("favouritesTotalPrice", currentTotalPrice);

    window.alert("Cart added to the favourites");
  }
}

//function to remove favourites
function resetFavourites() {
  localStorage.removeItem("favourites");
  window.alert("Favourites is cleared");
  const cartTable = cartTableContainer.querySelector("table");
}

//function to load the favourites
function getFromfavs() {
  const storedCartData = localStorage.getItem("favourites");
  const storedTotalPrice =
    parseFloat(localStorage.getItem("favouritesTotalPrice")) || 0;

  if (storedCartData) {
    const cartData = JSON.parse(storedCartData);
    let cartTable = cartTableContainer.querySelector("table");

    if (!cartTable) {
      cartTable = document.createElement("table");
      cartTable.className = "cart-table";

      const tableHeaderRow = document.createElement("tr");
      const tableHeaderCells = ["Product", "Image", "Quantity", "Price"];
      tableHeaderCells.forEach((cellText) => {
        const tableHeaderCell = document.createElement("th");
        tableHeaderCell.textContent = cellText;
        tableHeaderRow.appendChild(tableHeaderCell);
      });
      cartTable.appendChild(tableHeaderRow);
      cartTableContainer.appendChild(cartTable);
    }

    let totalPrice = storedTotalPrice; //we let the total price= to the total price in the local storage

    cartData.forEach((item) => {
      const cartTableRow = document.createElement("tr");
      cartTableRow.className = "cart-table-row";

      const productNameCell = document.createElement("td");
      productNameCell.textContent = item.name;

      const productImageCell = document.createElement("td");
      const productImage = document.createElement("img");
      productImage.src = item.image;
      productImage.alt = item.name;
      productImageCell.appendChild(productImage);

      const quantityCell = document.createElement("td");
      quantityCell.textContent = item.quantity;

      const totalPriceForItem =
        parseFloat(item.price) * parseFloat(item.quantity);

      const priceCell = document.createElement("td");
      priceCell.textContent = `Rs. ${totalPriceForItem}`;

      cartTableRow.appendChild(productNameCell);
      cartTableRow.appendChild(productImageCell);
      cartTableRow.appendChild(quantityCell);
      cartTableRow.appendChild(priceCell);

      cartTable.appendChild(cartTableRow);

      totalPrice += totalPriceForItem;
    });
    totalDiv.textContent = `Total: Rs. ${totalPrice}`;
  }
}

//function to clear the cart
function clearCart() {
  localStorage.removeItem("cartData");
  window.alert("Cart is cleared");
  const cartTable = cartTableContainer.querySelector("table");
  if (cartTable) {
    cartTable.remove();
  }
}

addCartToFavouritesButton.addEventListener("click", addtofav);
removeFavouritesButton.addEventListener("click", resetFavourites);
addFavouritesButton.addEventListener("click", getFromfavs);
clearCartButton.addEventListener("click", clearCart);

const buyNowButton=document.getElementById("buy-now");

buyNowButton.addEventListener("click", ()=>{
  const cartTable=cartTableContainer.querySelector("table");
  const cartData=[];
  const totalDiv=document.querySelector(".total").textContent;

  if(cartTable){
    const cartRows=cartTable.querySelectorAll("tr.cart-table-row");

    cartRows.forEach((row)=>{
      const productName=row.cells[0].textContent
      const productImage=row.cells[1].querySelector("img").src;
      const quantity=parseFloat(row.cells[2].textContent);
      const price=parseFloat(
        row.cells[3].textContent.replace("Rs.","").trim()
      )

      cartData.push({
        name:productName,
        image:productImage,
        quantity:quantity,
        price:price,
      })
    })
  }
  localStorage.setItem("orderData", JSON.stringify(cartData));
  localStorage.setItem("orderTotal",totalDiv);

  window.location.href="order.html";
})








// /

//     localStorage.setItem("orderData", JSON.stringify(cartData));
//     localStorage.setItem("orderTotal", totalDiv);

//     window.location.href = "order.html";  // Redirect to order.html
// });
